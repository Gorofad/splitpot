## -*- coding: utf-8 -*-
<%inherit file="base.html" />
<%! import cherrypy %>
<%! from Auth import getCurrentUserName %>
<%! from DatabaseParser import resolveNick %>
Your debts: ${("%.2f" % debts).replace('.', ',')}€ <br />
Others owe you: ${("%.2f" % others_debts).replace('.',',')}€ <br />
<hr />
<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="expensesTable">
    <thead>
        <tr>
          <th>Date</th>
          <th>Host</th>
          <th>Amount</th>
          <th>Details</th>
        </tr>
    </thead>
    <tbody>
        % for x in entries:
        <tr>
          <td>
              ${x.date.strftime("%d %b")}
          </td>
          <td>
              % if x.owner == getCurrentUserName():
                  ${"you"} 
              % else:
                  ${resolveNick(x.owner)}
              % endif
          </td>
          <td>
            ${("%.2f" % (x.amount / float(len(x.participants) + 1))).replace('.',',')}€
          </td>
          <td>
              <a href="${cherrypy.url('event/' + str(x.id))}"><i class="icon-eye-open"></i></a>
            % if x.owner == getCurrentUserName():
                <a href="#"><i class="icon-pencil"></i></a>
                <!-- <a class="confirm-delete" data-id=${str(x.id)} role="button" data-toggle="modal"><i class="icon-trash"></i></a> -->
                <a class="#"><i class="icon-trash"></i></a>
                <a class="#"><i class="icon-ok"></i></a>
            % endif
          </td>
        </tr>
        % endfor
    </tbody>
</table>

<div class="modal small hide fade" id="deleteConfirmation" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3>Delete Confirmation</h3>
    </div>
    <div class="modal-body">
        <p class="error-text">Are you sure you want to delete this event?</p>
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <a href="${cherrypy.url('splitpot/doRemoveEvent?id=')}" class="btn btn-danger">Delete</a>
    </div>
</div>

<script>
    $(document).ready(function() {
        // make table look nice with DataTables
        $('#expensesTable').dataTable({
            "sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>",
            "bInfo": false,
		    "aaSorting": [[ 0, "desc" ]],
            "aoColumns": [
			    { "asSorting": [ "desc", "asc" ] },
			    null, 
			    null, 
			    null,
            ],
            "oLanguage": {
                "sSearch": "<i class='icon-search'></i>&nbsp;",
            }
        });

        $.extend( $.fn.dataTableExt.oStdClasses, {
            "sWrapper": "dataTables_wrapper form-inline"
        });

        $('#deleteConfirmation').bind('show', function() {
            var id = $(this).data('id');
            removeBtn = $(this).find('.btn-danger');
            href = removeBtn.attr('href');

            removeBtn.attr('href', href.replace(/id=(\w|\@|\.)*/, 'id=' + id));
        });

        $('.confirm-delete').click(function(e) {
            e.preventDefault();

            var id = $(this).data('id');
            $('#deleteConfirmation').data('id', id).modal('show');
        });
    });
</script>
